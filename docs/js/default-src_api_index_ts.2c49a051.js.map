{"version":3,"file":"js/default-src_api_index_ts.2c49a051.js","mappings":"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","sources":["webpack://sourcedao-pc-dapp/./src/api/contract.ts","webpack://sourcedao-pc-dapp/./src/api/user/index.ts"],"sourcesContent":["import { keyStores, KeyPair, Contract, connect } from 'near-api-js'\r\n\r\nimport store from '@store/index'\r\n\r\nimport { CONNECTIONCONFIG, CONTRACTID } from './config'\r\n\r\nexport interface ContractError {\r\n  kind: {\r\n    ExecutionError: string\r\n  }\r\n}\r\n\r\nexport default class Contracts {\r\n  protected address = CONTRACTID\r\n  protected viewMethods: string[] = []\r\n  protected changeMethods: string[] = []\r\n  // protected contract!: UserContract\r\n  protected _contract: Contract | undefined\r\n\r\n  protected async senderChangeMethod(\r\n    methodName: string,\r\n    args?: Record<string, unknown>\r\n  ): Promise<string> {\r\n    const tx = {\r\n      receiverId: this.address,\r\n      actions: [\r\n        {\r\n          methodName,\r\n          args,\r\n        },\r\n      ],\r\n    }\r\n\r\n    const res = await window.near!.signAndSendTransaction(tx)\r\n\r\n    return window.atob(res.response[0].status.SuccessValue)\r\n  }\r\n\r\n  protected async senderViewMethod<T>(\r\n    methodName: string,\r\n    args?: Record<string, unknown>\r\n  ): Promise<T> {\r\n    return window.near!.account().viewFunction(this.address, methodName, args)\r\n  }\r\n\r\n  protected async near(): Promise<void> {\r\n    const { accountAddress, accessKey } = store.getState().wallet\r\n\r\n    const keyStore = new keyStores.InMemoryKeyStore()\r\n    const keyPair = KeyPair.fromString(accessKey!.secretKey)\r\n    await keyStore.setKey(CONNECTIONCONFIG.networkId, accountAddress, keyPair)\r\n    const near = await connect(Object.assign({ keyStore }, CONNECTIONCONFIG))\r\n    const account = await near.account(accountAddress)\r\n    this._contract = new Contract(account, this.address, {\r\n      viewMethods: this.viewMethods,\r\n      changeMethods: this.changeMethods,\r\n    })\r\n  }\r\n\r\n  protected async changeContract(\r\n    methodName: string,\r\n    args?: Record<string, unknown>\r\n  ): Promise<string> {\r\n    const { currentWallet } = store.getState().wallet\r\n    switch (currentWallet) {\r\n      case 'Sender':\r\n        return this.senderChangeMethod(methodName, args)\r\n      default:\r\n        throw Error()\r\n    }\r\n  }\r\n\r\n  protected async viewContract<T>(\r\n    methodName: string,\r\n    args?: Record<string, unknown>\r\n  ): Promise<T> {\r\n    const { currentWallet } = store.getState().wallet\r\n    switch (currentWallet) {\r\n      case 'Sender':\r\n        return this.senderViewMethod<T>(methodName, args)\r\n      default:\r\n        throw Error()\r\n    }\r\n  }\r\n}\r\n","import Contracts from '@api/contract'\r\nimport type { Friends } from '@store/modules/friends'\r\nimport type { Room } from '@store/modules/room'\r\n\r\ninterface UserContract {\r\n  register: (params: { name: string; image: string }) => boolean\r\n  login: (params: { hash: string }) => [string, string]\r\n  get_friend_list: (params: { account_id: string }) => Friends[]\r\n  add_friend: (params: { friend_account_id: string }) => boolean\r\n}\r\n\r\ninterface RoomListRes {\r\n  0: number\r\n  1: Room\r\n}\r\n\r\nclass User extends Contracts {\r\n  changeMethods = ['register', 'login', 'add_friend']\r\n\r\n  viewMethods = ['get_friend_list']\r\n\r\n  contract(): UserContract {\r\n    return this._contract as unknown as UserContract\r\n  }\r\n\r\n  async register(name: string, image: string): Promise<boolean> {\r\n    const res = await this.changeContract('register', { name, image })\r\n    return JSON.parse(res)\r\n  }\r\n\r\n  async login(hash: string): Promise<[string, string]> {\r\n    const res = await this.changeContract('login', { hash })\r\n    return JSON.parse(res)\r\n  }\r\n\r\n  async get_friend_list(account_id: string): Promise<Friends[]> {\r\n    return this.viewContract<Friends[]>('get_friend_list', { account_id })\r\n  }\r\n\r\n  async add_friend(friend_account_id: string): Promise<boolean> {\r\n    const res = await this.changeContract('add_friend', { friend_account_id })\r\n    return JSON.parse(res)\r\n  }\r\n\r\n  async get_room_list(): Promise<RoomListRes[]> {\r\n    return this.viewContract<RoomListRes[]>('get_room_list')\r\n  }\r\n\r\n  async create_room(name: string, nft: string[]): Promise<number> {\r\n    const res = await this.changeContract('create_room', { name, nft })\r\n    return JSON.parse(res)\r\n  }\r\n\r\n  async destory_room(room_id: number): Promise<number> {\r\n    const res = await this.changeContract('destory_room', { room_id })\r\n    return JSON.parse(res)\r\n  }\r\n}\r\n\r\nlet instance\r\n\r\nexport default (() => {\r\n  if (instance) return instance\r\n  instance = new User()\r\n  return instance\r\n})()\r\n"],"names":["instance","Contracts","CONTRACTID","methodName","args","tx","receiverId","this","address","actions","window","near","signAndSendTransaction","res","atob","response","status","SuccessValue","account","viewFunction","store","wallet","accountAddress","accessKey","keyStore","keyStores","keyPair","KeyPair","secretKey","setKey","CONNECTIONCONFIG","connect","Object","assign","_contract","Contract","viewMethods","changeMethods","currentWallet","senderChangeMethod","Error","senderViewMethod","i","name","image","changeContract","JSON","parse","hash","account_id","viewContract","friend_account_id","nft","room_id"],"sourceRoot":""}